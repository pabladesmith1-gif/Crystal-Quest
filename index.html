<html lang="en"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crystal Quest</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&amp;display=swap" rel="stylesheet">

<link rel="stylesheet" href="styles.css"></head>
<body>
<div style="display:none"></div>
<div class="game-container">
<div class="ui-bar">
<span id="healthBar"></span>
<canvas id="manaBar" width="120" height="30" style="margin-top:15px"></canvas>
</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div class="transition-overlay" id="transitionOverlay"></div>

<div id="portalTransitionModal" class="modal hidden">
    <div class="portal-content">
        <div class="portal-particles">
            <div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div>
        </div>
        <h1>The Volcanic Portal Awakens...</h1>
        <p style="font-size: 1.8rem; color: #ffa500; text-shadow: 0 0 10px #ff4500; margin-top: 20px; animation: fire-flicker 0.5s infinite alternate;">
            Stepping into the realm of molten stone and endless flame
        </p>
    </div>
</div>
<div id="inventoryTooltip" class="tooltip hidden"></div>
<div id="shopTooltip" class="hidden"></div>

<div id="mainMenuModal" class="modal crystal-modal">
    <div class="modal-decor top-left"></div>
    <div class="modal-decor top-right"></div>
    <h1>Crystal Quest</h1>
    <div class="menu-buttons">
        <button id="newGameButton">New Quest</button>
        <button id="settingsButton">Settings</button>
    </div>
    <div class="modal-decor bottom-left"></div>
    <div class="modal-decor bottom-right"></div>
</div>

<div id="settingsModal" class="modal hidden">
<h1>Settings</h1>
<div class="settings-grid">
<div class="control-option">
<h3>Movement</h3>
<div class="difficulty-buttons">
<button id="arrowControlsButton" class="active">Arrows</button>
<button id="wasdControlsButton">WASD</button>
</div>
</div>
<div class="control-option">
<h3>Aim / Attack</h3>
<div class="difficulty-buttons">
<button id="keyboardAimButton" class="active">Keyboard</button>
<button id="mouseAimButton">Mouse</button>
</div>
</div>
</div>
<button id="backToMenuButton">Back</button>
</div>
<div id="difficultyModal" class="modal hidden">
<h1>Select Difficulty</h1>
<div class="difficulty-buttons">
<button id="easyButton">Apprentice</button>
<button id="hardButton">Master</button>
</div>
</div>
<div id="instructionsModal" class="modal hidden">
<h1>Instructions</h1>
<p>Use ARROW KEYS to move<br>
SPACE to cast spells, Z for Fireball<br>
Press 'I' for inventory<br>
Press 'E' to talk to the merchant<br>
Press 'M' for the world map<br>
Collect the 3 Sacred Crystals from the Guardians<br>
to unlock the path to the Shadow Lord!</p>
<button id="startButton">Begin Quest</button>
</div>
<div id="gameOverModal" class="modal hidden">
<h1>Quest Failed</h1>
<p>Your magical journey ends here...<br>But true wizards never give up!</p>
<button id="restartButton">Try Again</button>
</div>
<div id="victoryModal" class="modal hidden">
<h1>Victory!</h1>
<p> You defeated the Shadow Lord!<br>The realm's crystals are saved!</p>
<button id="restartButton2">New Quest</button>
</div>

<div id="inventoryModal" class="modal hidden">
    <div class="inventory-layout">
        <div class="inventory-left-panel">
            <h2>Wizard Status</h2>
            <div class="inventory-stats">
                <p><canvas id="invGoldIcon" width="24" height="24"></canvas> Crystals: <span id="inventoryGold">0</span></p>
                <p>Mana: <span id="inventoryMana">100</span> / <span id="inventoryMaxMana">100</span></p>
            </div>
            
            <h3>Equipped Hat</h3>
            <div class="equipped-item-slot">
                <canvas id="equippedHatIcon" class="upgrade-icon acquired" width="50" height="50"></canvas>
            </div>

            <h3>Sacred Crystals</h3>
            <div class="sacred-crystals-grid">
                <canvas id="fireCrystalIcon" class="upgrade-icon" width="50" height="50"></canvas>
                <canvas id="iceCrystalIcon" class="upgrade-icon" width="50" height="50"></canvas>
                <canvas id="stormCrystalIcon" class="upgrade-icon" width="50" height="50"></canvas>
            </div>
        </div>
        <div class="inventory-right-panel">
            <div class="inventory-tabs">
                <button class="tab-button active" data-tab="upgradesTab">Upgrades</button>
                <button class="tab-button" data-tab="hatsTab">Hats</button>
            </div>
            <div id="upgradesTab" class="tab-content active">
                <h3>Permanent Upgrades</h3>
                 <div class="upgrades-grid">
                    <canvas id="arcaneArmorIcon" class="upgrade-icon" width="50" height="50"></canvas>
                    <canvas id="powerBoltIcon" class="upgrade-icon" width="50" height="50"></canvas>
                    <canvas id="swiftCasterIcon" class="upgrade-icon" width="50" height="50"></canvas>
                    <canvas id="lifeStealIcon" class="upgrade-icon" width="50" height="50"></canvas>
                    <canvas id="goldMagnetIcon" class="upgrade-icon" width="50" height="50"></canvas>
                </div>
            </div>
            <div id="hatsTab" class="tab-content">
                <h3>Owned Hats</h3>
                <div class="upgrades-grid" id="ownedHatsGrid">
                    </div>
            </div>
        </div>
    </div>
    <p class="close-hint">(Press 'I' or ESC to close)</p>
</div>

<div id="shopModal" class="modal shop-interface hidden">
    <h2>Mystic Emporium</h2>
    <div class="inventory-stats">
        <p><canvas id="shopGoldIcon" width="24" height="24"></canvas> Your Crystals: <span id="shopGold">0</span></p>
    </div>
    <div class="shop-item-grid">
    </div>
    <p class="close-hint">(Press 'E' or ESC to close)</p>
</div>

<div id="hatShopModal" class="modal shop-interface hidden">
    <h2>Hat Trader</h2>
    <div class="inventory-stats">
        <p><canvas id="hatShopGoldIcon" width="24" height="24"></canvas> Your Crystals: <span id="hatShopGold">0</span></p>
    </div>
    <div class="shop-item-grid" id="hat-shop-item-grid">
    </div>
    <p class="close-hint">(Press 'E' or ESC to close)</p>
</div>

<div id="mapModal" class="modal hidden">
    <h1>World Map</h1>
    <canvas id="mapCanvas" width="400" height="400"></canvas>
    <div class="map-legend">
        <div class="map-legend-item"><canvas id="legend-you" width="18" height="18"></canvas> You</div>
        <div class="map-legend-item"><canvas id="legend-shop" width="18" height="18"></canvas> Emporium</div>
        <div class="map-legend-item"><canvas id="legend-hat-shop" width="18" height="18"></canvas> Hat Shop</div>
        <div class="map-legend-item"><canvas id="legend-boss" width="18" height="18"></canvas> Guardian</div>
        <div class="map-legend-item"><div class="map-legend-swatch" style="background:#4a2c17"></div> Fire Biome</div>
        <div class="map-legend-item"><div class="map-legend-swatch" style="background:#1e293b"></div> Crystal Biome</div>
        <div class="map-legend-item"><div class="map-legend-swatch" style="background:#1e1b4b"></div> Storm Biome</div>
        <div class="map-legend-item"><div class="map-legend-swatch" style="background:#0f0a19"></div> Shadow Biome</div>
        <div class="map-legend-item"><div class="map-legend-swatch" style="background:#222">?</div> Unexplored</div>
    </div>
    <p class="close-hint">(Press 'M' or ESC to close)</p>
</div>
</div>

<script src="engine.js"></script>
<script src="level1.js"></script>
</body></html>