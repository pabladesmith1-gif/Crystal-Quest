/* Style block 1 */
body{margin:0;padding:0;background:#000;color:#fff;font-family:'VT323',monospace;display:flex;justify-content:center;align-items:center;width:100vw;height:100vh;overflow:hidden}.game-container{width:800px;height:660px;border:4px solid #444;background:#000;position:relative;transform-origin:center}.ui-bar{width:800px;height:60px;background:#222;border-bottom:3px solid #444;display:flex;align-items:center;justify-content:space-between;padding:0 20px;box-sizing:border-box;font-size:20px}.ui-bar canvas{display:inline-block;vertical-align:middle;margin-right:2px;image-rendering:pixelated}canvas#gameCanvas{display:block;image-rendering:pixelated}.modal{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);border:4px solid #fff;padding:30px;text-align:center;min-width:400px;z-index:10}.modal h1{font-size:3rem;margin:0 0 20px 0;color:#96f}.modal p{font-size:1.3rem;margin:0 0 25px 0;line-height:1.4}.modal button{font-family:'VT323',monospace;font-size:1.5rem;padding:12px 25px;background:#96f;color:#000;border:0;cursor:pointer;transition:background .2s;width:100%;margin-top:10px}.modal button:hover{background:#73c}.hidden{display:none}.transition-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;opacity:0;pointer-events:none;transition:opacity .3s}.transition-overlay.active{opacity:1}.inventory-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px;padding:10px;background:#111;border:2px solid #444}.inventory-slot{width:60px;height:60px;background:#222;border:2px solid #444;display:flex;justify-content:center;align-items:center}.inventory-stats p{font-size:1.5rem;margin:10px 0;text-align:left;display:flex;align-items:center}.inventory-stats canvas{display:inline-block;margin-right:8px}.close-hint{font-size:1rem!important;color:#888;margin-top:20px!important;margin-bottom:0!important}.difficulty-buttons{display:flex;gap:15px;justify-content:center}.difficulty-buttons button.active{background:#73c;color:#fff;box-shadow:inset 0 0 10px #000}.upgrades-section{margin-top:20px;padding-top:15px;border-top:2px solid #444}.upgrades-section h2{font-size:1.8rem;margin:0 0 10px 0;color:#96f}.upgrades-grid{display:flex;justify-content:center;gap:15px}.upgrade-icon{width:50px;height:50px;background:#222;border:2px solid #444;opacity:.3}.upgrade-icon.acquired{opacity:1}.tooltip{position:absolute;background:rgba(0,0,0,0.9);border:2px solid #fff;padding:10px;font-size:1.1rem;max-width:250px;text-align:left;pointer-events:none;z-index:20;line-height:1.2}.tooltip h3{margin:0 0 5px 0;color:#ff0;font-size:1.2rem}.tooltip p{margin:0;font-size:1rem}.tooltip .hint{color:#888;font-style:italic}#shopTooltip{position:absolute;background:rgba(0,0,0,0.8);color:#fff;padding:8px 12px;border-radius:4px;font-size:1.2rem;pointer-events:none;z-index:5;border:1px solid #fff}

/* --- Main Menu & Crystal Modal Overhaul Styles --- */
.crystal-modal {
    min-width: 550px; /* Increased width to better fit shops */
    padding: 40px;
    background: linear-gradient(135deg, #1e1b4b, #2d1b69, #4c1d95, #1e1b4b);
    background-size: 400% 400%;
    border-image: linear-gradient(to right, #a78bfa, #c4b5fd, #a78bfa) 1;
    border-width: 4px;
    border-style: solid;
    box-shadow: 0 0 30px rgba(167, 139, 250, 0.5), inset 0 0 20px rgba(0,0,0,0.5);
    animation: breathing-background 10s ease infinite;
}

@keyframes breathing-background {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
}

.crystal-modal h1 {
    color: #fff;
    text-shadow: 0 0 3px #fff, 0 0 8px #e9d5ff, 0 0 15px #c4b5fd, 0 0 20px #a78bfa;
    font-size: 5rem;
    animation: crystal-pulse 2.5s infinite;
    margin-bottom: 40px;
    position: relative;
}

@keyframes crystal-pulse{
    0%,100%{transform:scale(1); text-shadow: 0 0 3px #fff, 0 0 8px #e9d5ff, 0 0 15px #c4b5fd, 0 0 20px #a78bfa;}
    50%{transform:scale(1.05); text-shadow: 0 0 6px #fff, 0 0 15px #e9d5ff, 0 0 25px #c4b5fd, 0 0 35px #a78bfa;}
}

.crystal-modal .menu-buttons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
}

.crystal-modal button {
    background: #4c1d95;
    color: #e9d5ff;
    border: 2px solid #a78bfa;
    box-shadow: inset 0 0 8px rgba(233, 213, 255, 0.5), 0 4px #2d1b69;
    text-shadow: 1px 1px #2d1b69;
    transition: all .1s ease;
    width: 80%;
    margin-top: 0;
}

.crystal-modal button:hover {
    background: #6d28d9;
    color: #fff;
    transform: translateY(-2px);
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.7), 0 6px #2d1b69, 0 0 15px #c4b5fd;
}

.crystal-modal button:active {
    transform: translateY(2px);
    box-shadow: inset 0 0 8px rgba(233, 213, 255, 0.5), 0 2px #2d1b69;
}

.modal-decor {
    width: 8px;
    height: 8px;
    background: #c4b5fd;
    position: absolute;
    animation: float-crystal 4s infinite ease-in-out;
    box-shadow: 
        0 -4px #a78bfa, 0 4px #a78bfa,
        4px 0 #7c3aed, -4px 0 #7c3aed,
        4px 4px #4c1d95, -4px 4px #4c1d95,
        4px -4px #4c1d95, -4px -4px #4c1d95;
}
.top-left { top: 20px; left: 20px; }
.top-right { top: 20px; right: 20px; animation-delay: -2s; }
.bottom-left { bottom: 20px; left: 20px; animation-delay: -1s; }
.bottom-right { bottom: 20px; right: 20px; animation-delay: -3s; }

@keyframes float-crystal {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
}
/* --- End of Main Menu Overhaul --- */

.crystal-sparkle{position:absolute;background:#96f;border-radius:50%;animation:sparkle 2s infinite ease-in-out}@keyframes sparkle{0%,100%{transform:scale(0);opacity:0}50%{transform:scale(1);opacity:1}}

/* --- Shop Modal Overhaul Styles --- */
.shop-interface {
    min-width: 600px;
    background: linear-gradient(135deg, #160b2f, #2c1a4e);
    border: 4px solid #4c1d95;
    box-shadow: 0 0 25px rgba(139, 92, 246, 0.4);
}
.shop-interface h2 {
    color: #a78bfa;
    text-shadow: 1px 1px #160b2f;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 2.5rem;
    border-bottom: 2px solid #4c1d95;
    padding-bottom: 10px;
}
.shop-interface .inventory-stats {
    padding-bottom: 10px;
    margin-bottom: 15px;
    border-bottom: 2px solid #4c1d95;
}
.shop-item-grid{display:grid;grid-template-columns:1fr;gap:15px;margin-top:20px}.shop-item{display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,0.3);padding:10px;border:2px solid #4c1d95}.shop-item-info{display:flex;align-items:center;text-align:left}.shop-item-info canvas{margin-right:15px}.shop-item-info h3{margin:0;font-size:1.5rem}.shop-item-info p{margin:0;font-size:1.2rem;color:#aaa}
.shop-item .buy-button{
    font-size:1.2rem;
    padding:8px 15px;
    width:auto;
    margin:0;
    background: #4c1d95;
    color: #e9d5ff;
    border: 2px solid #a78bfa;
    box-shadow: inset 0 0 8px rgba(233, 213, 255, 0.2), 0 3px #2d1b69;
    text-shadow: 1px 1px #2d1b69;
    transition: all .1s ease;
}
.shop-item .buy-button:hover {
    background: #6d28d9;
    color: #fff;
    transform: translateY(-2px);
    box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.4), 0 5px #2d1b69;
}
.shop-item .buy-button:active {
     transform: translateY(1px);
    box-shadow: inset 0 0 8px rgba(233, 213, 255, 0.2), 0 2px #2d1b69;
}
.shop-item .buy-button:disabled{background:#374151;color:#6b7280;cursor:not-allowed; border: 2px solid #4b5563; box-shadow: none; transform: none;}
/* --- End of Shop Modal Styles --- */

#mapCanvas{background:#111;border:2px solid #444;margin-bottom:20px}.map-legend{display:grid;grid-template-columns:repeat(3,1fr);justify-content:center;gap:10px 20px;font-size:1.1rem;margin-top:10px}.map-legend-item{display:flex;align-items:center;gap:8px}.map-legend-swatch{width:18px;height:18px;border:1px solid #fff;display:flex;justify-content:center;align-items:center;font-size:14px}.map-legend-item canvas{border:1px solid #fff}.settings-grid{display:flex;flex-direction:column;gap:25px;margin-bottom:25px}.control-option{background:#111;padding:15px;border:2px solid #444}.control-option h3{font-size:1.5rem;margin:0 0 15px 0;color:#ff0}

/* --- Enhanced Fire Portal Transition Styles --- */
#portalTransitionModal {
    top: 330px; /* Position below UI bar */
    height: 600px;
    width: 800px;
    background: radial-gradient(ellipse at center, 
        rgba(44, 10, 10, 1) 0%, 
        rgba(127, 29, 29, 0.9) 20%,
        rgba(220, 38, 38, 0.7) 40%,
        rgba(0, 0, 0, 1) 80%);
    border: none;
    align-items: center;
    justify-content: center;
    animation: fire-portal-breathe 3s ease-in-out infinite;
}

@keyframes fire-portal-breathe {
    0%, 100% { 
        background: radial-gradient(ellipse at center, 
            rgba(44, 10, 10, 1) 0%, 
            rgba(127, 29, 29, 0.9) 20%,
            rgba(220, 38, 38, 0.7) 40%,
            rgba(0, 0, 0, 1) 80%);
    }
    50% { 
        background: radial-gradient(ellipse at center, 
            rgba(127, 29, 29, 1) 0%, 
            rgba(220, 38, 38, 0.95) 25%,
            rgba(249, 115, 22, 0.8) 45%,
            rgba(0, 0, 0, 1) 75%);
    }
}

#portalTransitionModal:not(.hidden) {
    display: flex;
}

#portalTransitionModal .portal-content {
    position: relative;
    text-align: center;
}

#portalTransitionModal h1 {
    font-size: 4rem;
    color: #ffa500;
    text-shadow: 
        0 0 5px #ff4500, 
        0 0 10px #ff4500, 
        0 0 20px #dc2626,
        0 0 30px #7f1d1d,
        2px 2px 0px #2c0a0a;
    animation: volcanic-pulse 1.2s infinite ease-in-out;
    letter-spacing: 2px;
}

@keyframes volcanic-pulse {
    0%, 100% { 
        transform: scale(1); 
        opacity: 0.9;
        text-shadow: 
            0 0 5px #ff4500, 
            0 0 10px #ff4500, 
            0 0 20px #dc2626,
            0 0 30px #7f1d1d,
            2px 2px 0px #2c0a0a;
    }
    50% { 
        transform: scale(1.03); 
        opacity: 1;
        text-shadow: 
            0 0 8px #ffa500, 
            0 0 15px #ff4500, 
            0 0 25px #dc2626,
            0 0 35px #7f1d1d,
            0 0 40px #2c0a0a,
            3px 3px 0px #2c0a0a;
    }
}

.portal-particles {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 1px;
    height: 1px;
}

.portal-particles .particle {
    position: absolute;
    top: 0;
    left: 0;
    width: 12px;
    height: 12px;
    background: radial-gradient(circle, #ffa500 0%, #ff4500 50%, #dc2626 100%);
    border-radius: 50%;
    box-shadow: 
        0 0 15px #ff8c00,
        0 0 25px #ff4500,
        inset 0 0 8px #fff;
    animation: volcanic-swirl 2.5s infinite linear;
}

.portal-particles .particle:nth-child(1) { animation-delay: 0s; }
.portal-particles .particle:nth-child(2) { animation-delay: -0.25s; width: 8px; height: 8px; }
.portal-particles .particle:nth-child(3) { animation-delay: -0.5s; width: 14px; height: 14px; }
.portal-particles .particle:nth-child(4) { animation-delay: -0.75s; width: 10px; height: 10px; }
.portal-particles .particle:nth-child(5) { animation-delay: -1s; width: 16px; height: 16px; }
.portal-particles .particle:nth-child(6) { animation-delay: -1.25s; width: 6px; height: 6px; }
.portal-particles .particle:nth-child(7) { animation-delay: -1.5s; width: 12px; height: 12px; }
.portal-particles .particle:nth-child(8) { animation-delay: -1.75s; width: 9px; height: 9px; }
.portal-particles .particle:nth-child(9) { animation-delay: -2s; width: 15px; height: 15px; }
.portal-particles .particle:nth-child(10) { animation-delay: -2.25s; width: 7px; height: 7px; }

@keyframes volcanic-swirl {
    0% { 
        transform: rotate(0deg) translateX(180px) scale(0); 
        opacity: 0;
        background: radial-gradient(circle, #ffa500 0%, #ff4500 50%, #dc2626 100%);
    }
    15% { 
        opacity: 0.8; 
        background: radial-gradient(circle, #fff 0%, #ffa500 30%, #ff4500 70%, #dc2626 100%);
    }
    50% { 
        opacity: 1;
        background: radial-gradient(circle, #fff 0%, #ffa500 20%, #ff4500 60%, #dc2626 100%);
    }
    85% { 
        opacity: 0.6;
        background: radial-gradient(circle, #ffa500 0%, #ff4500 50%, #7f1d1d 100%);
    }
    100% { 
        transform: rotate(360deg) translateX(180px) scale(1.8); 
        opacity: 0;
        background: radial-gradient(circle, #dc2626 0%, #7f1d1d 50%, #2c0a0a 100%);
    }
}

.portal-particles .particle:nth-child(even) {
    animation-name: volcanic-swirl-reverse;
}

@keyframes volcanic-swirl-reverse {
    0% { 
        transform: rotate(0deg) translateX(220px) scale(0); 
        opacity: 0;
        background: radial-gradient(circle, #dc2626 0%, #7f1d1d 50%, #2c0a0a 100%);
    }
    20% { 
        opacity: 0.9;
        background: radial-gradient(circle, #ff4500 0%, #dc2626 60%, #7f1d1d 100%);
    }
    60% { 
        opacity: 1;
        background: radial-gradient(circle, #fff 0%, #ffa500 25%, #ff4500 65%, #dc2626 100%);
    }
    90% { 
        opacity: 0.4;
        background: radial-gradient(circle, #ffa500 0%, #dc2626 70%, #2c0a0a 100%);
    }
    100% { 
        transform: rotate(-360deg) translateX(220px) scale(2); 
        opacity: 0;
        background: radial-gradient(circle, #7f1d1d 0%, #2c0a0a 100%);
    }
}

@keyframes fire-flicker {
    0% { 
        opacity: 0.8; 
        text-shadow: 0 0 8px #ff4500, 0 0 15px #dc2626;
    }
    100% { 
        opacity: 1; 
        text-shadow: 0 0 12px #ffa500, 0 0 20px #ff4500, 0 0 25px #dc2626;
    }
}
/* --- End of Enhanced Fire Portal Styles --- */

/* --- Inventory Overhaul Styles --- */
#inventoryModal {
    min-width: 700px;
    padding: 20px;
    background: linear-gradient(135deg, #160b2f, #2c1a4e);
    border: 4px solid #4c1d95;
    box-shadow: 0 0 25px rgba(139, 92, 246, 0.4);
}
#inventoryModal h2, #inventoryModal h3 {
    color: #a78bfa;
    text-shadow: 1px 1px #160b2f;
    margin-top: 0;
    margin-bottom: 10px;
}
.inventory-layout {
    display: flex;
    gap: 20px;
}
.inventory-left-panel, .inventory-right-panel {
    background: rgba(0,0,0,0.3);
    border: 2px solid #4c1d95;
    padding: 15px;
}
.inventory-left-panel {
    width: 35%;
    display: flex;
    flex-direction: column;
}
.inventory-right-panel {
    width: 65%;
}
.inventory-left-panel .inventory-stats {
    border-bottom: 2px solid #4c1d95;
    padding-bottom: 10px;
    margin-bottom: 15px;
}
.equipped-item-slot {
    background: #111;
    border: 2px solid #444;
    padding: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 15px;
}
#equippedHatIcon.upgrade-icon.acquired {
    border-color: #facc15; /* Gold border for equipped */
}
.sacred-crystals-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    background: #111;
    border: 2px solid #444;
    padding: 10px;
    margin-top: auto; /* Pushes to the bottom */
}
.inventory-tabs {
    display: flex;
    border-bottom: 2px solid #4c1d95;
    margin-bottom: 15px;
}
.tab-button {
    font-size: 1.3rem;
    padding: 8px 15px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: #a78bfa;
    cursor: pointer;
    margin: 0 5px -2px 0;
}
.tab-button:hover {
    background: #4c1d95;
}
.tab-button.active {
    background: #2d1b69;
    color: #fff;
    border-bottom-color: #c4b5fd;
}
.tab-content {
    display: none;
}
.tab-content.active {
    display: block;
}
.tab-content .upgrades-grid {
    justify-content: flex-start;
    flex-wrap: wrap;
    background: none;
    border: none;
    padding: 0;
}
#ownedHatsGrid .upgrade-icon {
    cursor: pointer;
}
#ownedHatsGrid .upgrade-icon:hover {
    border-color: #fff;
}
/* --- End of Inventory Styles --- */